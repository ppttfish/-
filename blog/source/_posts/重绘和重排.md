---
title: 重绘和重排
Date: 2018-6-3
tags: 
- css
- 网页性能
---

浏览器在解析完所有资源后，会生成两个内部数据结构，表示页面结构的`DOM树`和表示DOM节点如何显示的`渲染树`。

元素的几何属性变化的时候，同样其他元素的几何属性也会受到影响。浏览器会使渲染树中受到影响的部分失效，并重新构建渲染树，这个过程就做`重排(reflow)`。

重排之后，浏览器会重新绘制受到影响的部分到屏幕上，这个过程叫做`重绘(repaint)`。

<!-- more -->

## 重排发生的时间

- 添加或删除可见的DOM元素。
- 元素位置改变。
- 元素尺寸改变(margin、padding、border、width、height)。
- 内容改变。
- 页面渲染器初始化。
- 浏览器窗口尺寸改变。
- 滚动条出现时。

重绘和重排都是非常耗费资源，是导致网页性能低下的重要原因。

## 减少重排和重绘的方法

- 对于DOM的读(或写)操作尽量放在一起，而且不要在两个读操作中插入一个写操作。
- 读DOM的结果如果使用次数大于一次，应该先储存起来。
- 不要一条条的更改样式，而是通过改变class属性来更改样式。
- 可以先将元素的`display`属性设置为`none`，然后在进行操作(期间无论对元素进行多少次操作)，最后再恢复元素显示，这样重排和重绘的次数只有2次，开始隐藏的一次和最后显示的一次。
- `positon`为`absolute`和`fixed`的元素，重排开销较小，因为不用考虑对其他元素的影响。
- 使用`虚拟DOM`的脚本库。
- 使用window.requestAnimationFrame()、window.requestIdleCallback()这两个函数。