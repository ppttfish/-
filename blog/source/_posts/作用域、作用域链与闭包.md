---
title: 作用域、作用域链与闭包
data: 2017-5-28
tags:
- js
- 作用域
- 闭包
- 学习笔记
---

记录一下学习相关的笔记。本文参考书籍：[《JavaScript权威指南》](https://book.douban.com/subject/10549733/) [《高性能JavaScript》](https://book.douban.com/subject/5362856/)

<!--more -->

## 作用域

>  一个变量的作用域是程序源代码中定义这个变量的区域。

比如全局变量的作用域就是全局，在JavaScript代码中的任何地方都是有定义的。而局部变量只在声明它们的函数体内有定义。

所以作用域决定了哪些变量可以被函数访问。

## 作用域链

我简单的理解为，作用域链是一个作用域内的对象列表。

比如在函数内，这个对象列表就保存了这个函数所有可访问的变量，包括全局变量和它内部定义的局部变量(在函数定义和执行时，它的作用域链是不同的)。

当执行函数时，遇到一个变量，JavaScript就会进行变量解析，它先会从对象列表中第一个对象开始查找，如果找到同名变量就使用这个值，否则就顺着作用域链在下一个对象中继续查找。以此类推，如果在作用域链上都没有匹配到这个变量，则这个变量就视为未定义的。

举个例子，有一个add()函数如下，

```js
function add(num1, num2) {
    var sum = num1 + num2;
    
    return sum;
}
```

它在定义时的作用域链如下：

 ![函数add()作用域链](https://ws4.sinaimg.cn/large/006tNc79ly1frr3yfojzjj30wy0bmack.jpg)

add(1, 2)运行时的作用域链如下：

![](https://ws1.sinaimg.cn/large/006tNc79ly1frr4r1ink1j30yy0m6gq1.jpg)



## 闭包

闭包其实是一个函数，这个函数可以访问局部作用域之外的数据。本来在函数的外部是无法访问到函数内部的变量的，但是通过闭包，就可以实现这个功能。

```Js
function greet() {
    var msg = 'hello';
    
     function f2() {
        console.log(msg);
    }
    
    return f2;
}

var hi = greet();
hi(); // hello
```

按道理，`greet`函数在调用结束后，它就应该被释放了，在它里边定义的变量也不存在了，结果在外边，我们还是得到了这个变量的值。这就是闭包的特性，f2函数此时就是一个闭包。

举一个之前用到的闭包实例。

